<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Reproducibility - The Rust Rand Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Extended documentation for Rust&#x27;s Rand lib">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Rand Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="reproducibility"><a class="header" href="#reproducibility">Reproducibility</a></h1>
<p>The <code>rust-random</code> libraries make limited commitments to reproducibility of seedable PRNGs and stochastic algorithms.</p>
<p>This chapter concerns value-stability of deterministic processes using the <code>rust-random</code> libraries.</p>
<h2 id="api-breaking-value-breaking-and-semver"><a class="header" href="#api-breaking-value-breaking-and-semver">API-breaking, value-breaking and SemVer</a></h2>
<p>A change (to a library) is considered <strong>API-breaking</strong> if it may cause a compilation failure of code which was compatible with a prior version of the API, or is otherwise an incompatible change.</p>
<p>We aim to follow <a href="https://semver.org/">SemVer rules</a> regarding API-breaking changes and <code>MAJOR.MINOR.PATCH</code> versions. That is, post 1.0, new minor versions should not introduce API-breaking changes.</p>
<p>A change is considered <strong>value-breaking</strong> if it is not API-breaking yet would result in changed output values of a deterministic stochastic process using only unchanged parts of the <code>rust-random</code> API.</p>
<p>Value-breaking changes are permitted in minor versions.</p>
<h2 id="non-portable-deterministic-items"><a class="header" href="#non-portable-deterministic-items">Non-portable deterministic items</a></h2>
<p>An item in a <code>rust-random</code> API (such as a struct or function) may be declared to be <strong>non-portable</strong>, meaning that it opts out of all reproducibility guarantees. Non-portable items may be deterministic, yet yield different results on different platforms and library versions (they may make value-breaking changes in any release).</p>
<p>This is a change in policy affecting <code>rand</code> from version <code>0.10</code> or <code>1.0</code> (whichever release is next); up to version <code>0.9</code> non-portable items were not permitted to make value-breaking changes in patch releases.</p>
<p>This non-portable declaration must be clearly mentioned in documentation. The following items make such a declaration:</p>
<ul>
<li><a href="https://docs.rs/rand/latest/rand/rngs/struct.SmallRng.html"><code>rand::rngs::SmallRng</code></a></li>
<li><a href="https://docs.rs/rand/latest/rand/rngs/struct.StdRng.html"><code>rand::rngs::StdRng</code></a></li>
</ul>
<h2 id="portable-items"><a class="header" href="#portable-items">Portable items</a></h2>
<p>Some items are clearly non-deterministic (e.g. <a href="https://docs.rs/rand/latest/rand/fn.rng.html"><code>rand::rng</code></a>). Some items are deterministic but non-portable (above). All other parts of the public API of <code>rust-random</code> crates (including PRNGs, distributions and other stochastic algorithms) are expected to be portable:</p>
<ul>
<li>Results should be reproducible across platforms</li>
<li>Results should be reproducible across patch releases</li>
<li>Minor releases, including after 1.0, may make value-breaking changes to portable items. Such changes must be well motivated and should be clearly mentioned in the CHANGELOG.</li>
</ul>
<h3 id="testing"><a class="header" href="#testing">Testing</a></h3>
<p>We expect all portable stochastic algorithms to test the value-stability of their output with some form of test vector.</p>
<ul>
<li>PRNGs should test against a reference vector where available (<a href="https://github.com/rust-random/rngs/blob/master/rand_xoshiro/src/xoshiro256starstar.rs#L122">example</a>)</li>
<li>Other algorithms should include their own test vectors within a
<code>value_stability</code> test or similar (<a href="https://github.com/rust-random/rand/blob/master/src/distr/bernoulli.rs#L226">example</a>)</li>
</ul>
<h2 id="support-for-prior-versions"><a class="header" href="#support-for-prior-versions">Support for prior versions</a></h2>
<p>We aim to support users of <code>rust-random</code> crates using a prior <code>MAJOR.MINOR</code> version for the purposes of reproducibility by:</p>
<ul>
<li>Providing security fixes as patch versions where appropriate</li>
<li>Facilitating the back-porting of compatible additions from future crate versions <em>on request</em></li>
<li>Other fixes may be considered for back-porting, but are often not possible without API-breaking or value-breaking changes</li>
</ul>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<h3 id="portability-of-usize"><a class="header" href="#portability-of-usize">Portability of usize</a></h3>
<p>There is unfortunately one non-portable item baked into the heart of the Rust
language: <code>usize</code> (and <code>isize</code>). For example, the size of an empty
<code>Vec</code> will differ on 32-bit and 64-bit targets. For most purposes this is not an
issue, but when it comes to generating random numbers in a portable manner
it does matter.</p>
<p>A simple rule follows: if portability is required, <em>never</em> sample a <code>usize</code> or
<code>isize</code> value directly.</p>
<p>From <code>rand v0.9</code>, <code>isize</code> and <code>usize</code> types are no longer supported in many parts of the public API, including <a href="https://docs.rs/rand/latest/rand/distr/struct.StandardUniform.html"><code>StandardUniform</code></a>. <code>usize</code> is supported by <a href="https://docs.rs/rand/latest/rand/distr/uniform/trait.SampleUniform.html"><code>SampleUniform</code></a> and thus <a href="https://docs.rs/rand/latest/rand/trait.Rng.html#method.random_range"><code>Rng::random_range</code></a>, using <code>u32</code> sampling whenever possible to maximise portability.</p>
<h3 id="portability-of-floats"><a class="header" href="#portability-of-floats">Portability of floats</a></h3>
<p>The results of floating point arithmetic depend on rounding modes and
implementation details. In particular, the results of transcendental functions vary
from platform to platform. Due to this, results of distributions in <code>rand_distr</code> using <code>f32</code> or <code>f64</code> may not be portable.</p>
<p>To alleviate (or further complicate) this concern, we prefer to use <code>libm</code> over <code>std</code> implementations of these transcendental functions. See <a href="crate-features.html#rand_distr-features">rand_distr features</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="crate-platforms.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="crate-platforms.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
